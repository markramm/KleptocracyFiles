<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Debugging Democracy — Interactive Timeline</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.4/tailwind.min.css" rel="stylesheet">
  <style>
    html, body { height: 100%; }
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica Neue, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    .line-clamp-1{ display:-webkit-box; -webkit-line-clamp:1; -webkit-box-orient:vertical; overflow:hidden; }
  </style>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
</head>
<body class="bg-neutral-950 text-neutral-100">
<div id="root"></div>
<script>
const e = React.createElement;

function EventItem({ ev }) {
  const [open, setOpen] = React.useState(false);
  return e(
    "div",
    { className: "border-b border-neutral-700 py-2" },
    e(
      "div",
      {
        className: "font-semibold cursor-pointer",
        onClick: () => setOpen((v) => !v),
      },
      `${ev.date} — ${ev.title}`
    ),
    open && ev.summary
      ? e("div", { className: "mt-1 text-sm" }, ev.summary)
      : null
  );
}

function App() {
  const [events, setEvents] = React.useState([]);
  const [query, setQuery] = React.useState("");

  React.useEffect(() => {
    if (location.protocol === "file:") {
      console.error("Use a local HTTP server (e.g. 'python -m http.server') to view the timeline.");
    }
    fetch("../timeline/index.json")
      .then((r) => r.json())
      .then((d) => setEvents(d.events || []))
      .catch((err) => console.error("failed to load index", err));
  }, []);

  const filtered = events.filter((ev) => {
    const q = query.toLowerCase();
    return (
      ev.title.toLowerCase().includes(q) ||
      (ev.summary && ev.summary.toLowerCase().includes(q))
    );
  });

  const grouped = filtered.reduce((acc, ev) => {
    const year = ev.date.slice(0, 4);
    (acc[year] ||= []).push(ev);
    return acc;
  }, {});
  const years = Object.keys(grouped).sort().reverse();

  return e(
    "div",
    { className: "max-w-4xl mx-auto p-4 space-y-6" },
    e("input", {
      className: "w-full p-2 rounded bg-neutral-800 text-neutral-100",
      placeholder: "Search…",
      value: query,
      onChange: (ev) => setQuery(ev.target.value),
    }),
    years.map((year) =>
      e(
        "div",
        { key: year },
        e("h2", { className: "text-xl font-bold mt-4 mb-2" }, year),
        grouped[year].map((ev) => e(EventItem, { key: ev.id, ev }))
      )
    )
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(e(App));
</script>
</body>
</html>
